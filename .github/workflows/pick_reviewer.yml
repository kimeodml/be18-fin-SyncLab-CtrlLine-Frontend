name: pick random reviewer

on:
  pull_request:
    types:
      - opened
    branches:
      - develop

jobs:
  pick-random-reviewer:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Pick Random Reviewer
        id: pick_random_reviewer
        uses: actions/github-script@v8
        with:
          github-token: ${{secrets.GITHUB_TOKEN}}
          script: |
            const fs = require('fs');
            const candidate = JSON.parse(fs.readFileSync(`${{ github.workspace }}/.github/workflows/reviewers.json`));
            const me = '${{ github.event.pull_request.user.login }}';
            const candidateWithoutMe = candidate.filter(id => id !== me);

            for (let i = candidateWithoutMe.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [candidateWithoutMe[i], candidateWithoutMe[j]] = [candidateWithoutMe[j], candidateWithoutMe[i]];
            }

            const picked = candidateWithoutMe.slice(0, 2); // ìƒìœ„ 2ëª… ì¶”ì¶œ
            const comment = `ğŸ‰ ëœë¤ ë¦¬ë·°ì–´ë¡œ ì„ ì •ëœ ë¶„ë“¤: @${picked.join(', @')} ğŸ™ ë¦¬ë·° ë¶€íƒë“œë¦½ë‹ˆë‹¤!`;

            core.setOutput('comment', comment);
            core.setOutput('reviewers', picked.join(','));

      - name: Comment PR
        uses: mshick/add-pr-comment@v2
        with:
          message: ${{ steps.pick_random_reviewer.outputs.comment }}
          repo-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Add PR Reviewer
        uses: madrapps/add-reviewers@v1
        with:
          reviewers: ${{ steps.pick_random_reviewer.outputs.reviewers }}
          token: ${{ secrets.GITHUB_TOKEN }}
